<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Clarion Context Engine</title>
    <!-- CSS Modules - Load in order of dependency -->
    <link rel="stylesheet" href="/assets/css/base.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/hero.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <link rel="stylesheet" href="/assets/css/animations.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/utilities.css">

</head>
<body>
    <main>
        <!-- Header Navigation -->
<header class="main-header">
    <div class="header-container">
        <div class="header-logo">
            <img src="/assets/images/Snowball_Systems_Logo-removebg-preview.png" alt="Snowball Systems" class="logo-image">
        </div>
        <div class="header-right">
            <nav class="header-nav">
                <a href="ICP_Pages/managers/" class="nav-link">Managers</a>
                <a href="ICP_Pages/engineers/" class="nav-link">Engineers</a>
                <a href="ICP_Pages/gis_experts/" class="nav-link">GIS Experts</a>
                <a href="ICP_Pages/managers/#demo" class="nav-link demo-link">Demo</a>
            </nav>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>
</header>

<style>
.cta-card:hover {
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.08) 0%, 
        rgba(255, 255, 255, 0.12) 50%, 
        rgba(255, 255, 255, 0.08) 100%) !important; /* Enhanced gradient */
    border: 1px solid rgba(255, 255, 255, 0.18) !important; /* More visible border */
    opacity: 1 !important; /* Full opacity on hover */
    box-shadow: 0 0 20px 0 rgba(74, 144, 226, 0.1) !important; /* Subtle glow */
    transform: translateY(-1px) !important; /* Very subtle lift */
    animation: none !important; /* Stop breathing animation on hover */
}
</style>

    <!-- Hero Section with Clarion Logo Centerpiece -->
    <section class="intelligence-hub-hero">
        <!-- Clean Background with Subtle Depth -->
        <div class="hero-background">
            <div class="floating-particles">
                <!-- Minimal animated particles for atmospheric depth -->
            </div>
            <div class="grid-overlay"></div>
        </div>


        
        <!-- Clarion Logo Centerpiece -->
        <div class="clarion-hero-content">
        <!-- Main Clarion Logo -->
        <div class="clarion-logo-container">
            <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 402.77 267.71">
      <defs>
        <style>
          .cls-1 {
            fill: url(#radial-gradient-3);
          }

          .cls-1, .cls-2, .cls-3, .cls-4, .cls-5, .cls-6, .cls-7, .cls-8 {
            stroke: none;
          }

          .cls-1, .cls-2, .cls-3, .cls-4, .cls-5, .cls-6, .cls-8 {
            stroke-width: 0px;
          }

          .cls-9 {
            letter-spacing: 0em;
          }

          .cls-2 {
            fill: url(#radial-gradient-8);
          }

          .cls-3 {
            fill: url(#radial-gradient-6);
          }

          .cls-10 {
            stroke: url(#linear-gradient-4);
          }

          .cls-10, .cls-11, .cls-12, .cls-13, .cls-14, .cls-15, .cls-16, .cls-17, .cls-18, .cls-19, .cls-20 {
            fill: none;
            stroke-width: 2.5px;
          }

          .cls-11 {
            stroke: url(#linear-gradient-7);
          }

          .cls-12 {
            stroke: url(#linear-gradient-6);
          }

          .cls-21 {
            font-size: 101.85px;
          }

          .cls-21, .cls-22 {
            font-family: Bahnschrift, Bahnschrift;
            font-variation-settings: 'wght' 400, 'wdth' 100;
          }

          .cls-13 {
            stroke: url(#linear-gradient-2);
          }

          .cls-14 {
            stroke: url(#linear-gradient-10);
          }

          .cls-22 {
            font-size: 19.95px;
          }

          .cls-15 {
            stroke: url(#linear-gradient-8);
          }

          .cls-16 {
            stroke: url(#linear-gradient-5);
          }

          .cls-4 {
            fill: url(#radial-gradient-2);
          }

          .cls-5 {
            fill: url(#radial-gradient-4);
          }

          .cls-6 {
            fill: url(#radial-gradient);
          }

          .cls-17 {
            stroke: url(#linear-gradient-11);
          }

          .cls-23 {
            letter-spacing: -.01em;
          }

          .cls-18 {
            stroke: url(#linear-gradient);
          }

          .cls-7 {
            fill: url(#radial-gradient-7);
            stroke: none;
            stroke-width: 0px;
          }

          .cls-8 {
            fill: url(#radial-gradient-5);
          }

          .cls-19 {
            stroke: url(#linear-gradient-3);
          }

          .cls-20 {
            stroke: url(#linear-gradient-9);
          }
        </style>
        <linearGradient id="linear-gradient" x1="-428.84" y1="602.24" x2="-427.61" y2="601.02" gradientTransform="translate(33621.55 -13828.7) scale(78.19 23.06)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-2" x1="-425.75" y1="602.58" x2="-423.15" y2="599.98" gradientTransform="translate(21395.48 12060.87) scale(50 -20)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-3" x1="-439.57" y1="599.25" x2="-421.12" y2="580.81" gradientTransform="translate(79161.78 579.6) scale(183.13 -.69)" xlink:href="#linear-gradient-2"/>
        <linearGradient id="linear-gradient-4" x1="-431.08" y1="614.77" x2="-429.13" y2="612.82" gradientTransform="translate(51773.3 33825.67) scale(120 -55)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-5" x1="-430.19" y1="614.23" x2="-429.13" y2="613.17" gradientTransform="translate(51893.3 33880.67) scale(120 -55)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-6" x1="-429.55" y1="617.32" x2="-427.67" y2="615.44" gradientTransform="translate(38771.37 58614) scale(90 -95)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-7" x1="-430.72" y1="612.67" x2="-429.62" y2="611.57" gradientTransform="translate(56237.27 27628.58) scale(130 -45)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-8" x1="-430.65" y1="617.15" x2="-429.59" y2="616.09" gradientTransform="translate(60441.25 58709) scale(140 -95)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-9" x1="-386.46" y1="617.15" x2="-385.44" y2="616.13" gradientTransform="translate(-16737.52 63307.68) rotate(-180) scale(44.33 102.5)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-10" x1="-438.08" y1="589.38" x2="-423.88" y2="575.17" gradientTransform="translate(86673.62 -300.06) scale(200.54 .81)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <linearGradient id="linear-gradient-11" x1="-420.61" y1="612.12" x2="-419.24" y2="610.75" gradientTransform="translate(12677.53 24475.04) scale(30 -40)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#6fa8dc" stop-opacity=".8"/>
          <stop offset="1" stop-color="#4a90e2" stop-opacity=".6"/>
        </linearGradient>
        <radialGradient id="radial-gradient" cx="-414.17" cy="603.41" fx="-414.17" fy="603.41" r=".5" gradientTransform="translate(8323.55 12090.87) scale(20 -20)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#4a90e2"/>
          <stop offset=".7" stop-color="#357abd"/>
          <stop offset="1" stop-color="#2c5f94"/>
        </radialGradient>
        <radialGradient id="radial-gradient-2" cx="-405.91" cy="600.9" fx="-405.91" fy="600.9" r=".5" gradientTransform="translate(7695.76 10960.46) scale(18 -18)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#4a90e2"/>
          <stop offset=".7" stop-color="#357abd"/>
          <stop offset="1" stop-color="#2c5f94"/>
        </radialGradient>
        <radialGradient id="radial-gradient-3" cx="-410.94" cy="603.32" fx="-410.94" fy="603.32" r=".5" gradientTransform="translate(9351.35 13461.29) scale(22 -22)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#4a90e2"/>
          <stop offset=".7" stop-color="#357abd"/>
          <stop offset="1" stop-color="#2c5f94"/>
        </radialGradient>
        <radialGradient id="radial-gradient-4" cx="-406.62" cy="597.78" fx="-406.62" fy="597.78" r=".5" gradientTransform="translate(6617.96 9570.04) scale(16 -16)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#4a90e2"/>
          <stop offset=".7" stop-color="#357abd"/>
          <stop offset="1" stop-color="#2c5f94"/>
        </radialGradient>
        <radialGradient id="radial-gradient-5" cx="-401.44" cy="594.51" fx="-401.44" fy="594.51" r=".5" gradientTransform="translate(5970.17 8379.62) scale(14 -14)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#4a90e2"/>
          <stop offset=".7" stop-color="#357abd"/>
          <stop offset="1" stop-color="#2c5f94"/>
        </radialGradient>
        <radialGradient id="radial-gradient-6" cx="-401.18" cy="604.46" fx="-401.18" fy="604.46" r=".5" gradientTransform="translate(3496.23 5307.98) scale(8.29 -8.53)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#4a90e2"/>
          <stop offset=".7" stop-color="#357abd"/>
          <stop offset="1" stop-color="#2c5f94"/>
        </radialGradient>
        <radialGradient id="radial-gradient-7" cx="-422.47" cy="612.11" fx="-422.47" fy="612.11" r=".5" gradientTransform="translate(18857.09 27030.87) scale(44 -44)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#4a90e2"/>
          <stop offset=".7" stop-color="#357abd"/>
          <stop offset="1" stop-color="#2c5f94"/>
        </radialGradient>
        <radialGradient id="radial-gradient-8" cx="-413.06" cy="603.95" fx="-413.06" fy="603.95" r=".5" gradientTransform="translate(10139.14 14551.71) scale(24 -24)" gradientUnits="userSpaceOnUse">
          <stop offset="0" stop-color="#4a90e2"/>
          <stop offset=".7" stop-color="#357abd"/>
          <stop offset="1" stop-color="#2c5f94"/>
        </radialGradient>
      </defs>
      
      <!-- Text elements will be moved to front by JavaScript -->
      <text class="cls-21" transform="translate(0 132.33) scale(1.14 1)"><tspan x="0" y="0">C</tspan><tspan class="cls-9" x="63.01" y="0">l</tspan><tspan x="92" y="0">arion</tspan></text>
      <text class="cls-22" transform="translate(280 157)" text-anchor="middle"><tspan x="0" y="0">context engine</tspan></text>
      <text/>
    </svg>
                </div>
        
        </div>
        
        <!-- Combined Hero Text and CTA Container -->
        <div class="hero-content-container">
            <!-- Hero Tagline -->
            <div class="hero-tagline">
                <h2>Graph powered intelligence & microservices integration layer</h2>
                <div class="hero-subtitle">
                    <span>designed for water utility:</span>
                </div>
            </div>
            
            <!-- ICP CTAs - Clean Design -->
            <div class="icp-ctas">
                <div class="cta-grid">
                    
                    <!-- Managers CTA -->
                    <a href="ICP_Pages/managers/" class="cta-card">
                        <div class="cta-text">
                            <h3>Managers</h3>
                        </div>
                    </a>
                    
                    <!-- Engineers CTA -->
                    <a href="ICP_Pages/engineers/" class="cta-card">
                        <div class="cta-text">
                            <h3>Engineers</h3>
                        </div>
                    </a>
                    
                    <!-- GIS Experts CTA -->
                    <a href="ICP_Pages/gis_experts/" class="cta-card">
                        <div class="cta-text">
                            <h3>GIS Experts</h3>
                        </div>
                    </a>
                    
                </div>
            </div>
        </div>
    </section>

<!-- The rest of the homepage is intentionally left blank for new concept development. -->

<!-- Load D3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- Clarion Neural Network Animation Module -->
<script src="assets/js/neural-network.js"></script>

// Mobile menu toggle function
function toggleMobileMenu() {
    const nav = document.querySelector('.header-nav');
    const toggle = document.querySelector('.mobile-menu-toggle');
    
    nav.classList.toggle('active');
    toggle.classList.toggle('active');
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
    const nav = document.querySelector('.header-nav');
    const toggle = document.querySelector('.mobile-menu-toggle');
    
    if (!nav.contains(event.target) && !toggle.contains(event.target)) {
        nav.classList.remove('active');
        toggle.classList.remove('active');
    }
});
</script>
    </main>
    <footer>
        <div class="container">
            <p>&copy; 2025 Clarion Context Engine. All rights reserved.</p>
        </div>
    </footer>
    <script>
        // Focused Knowledge Graph with Clear Theme Transitions
        class FocusedKnowledgeGraph {
            constructor() {
                this.canvas = null;
                this.ctx = null;
                this.container = null;
                this.nodes = new Map();
                this.particles = [];
                this.currentTheme = 0;
                this.animationId = null;
                this.isTransitioning = false;
                
                // Three focused themes with clear, distinct animations
                this.themes = [
                    {
                        name: 'Asset Management',
                        text: 'Asset Management',
                        description: 'Complete lifecycle tracking and optimization',
                        primaryColor: 'rgba(66, 165, 245, 0.8)',
                        secondaryColor: 'rgba(30, 136, 229, 0.6)',
                        flows: [
                            { from: 'gis', to: 'assets', intensity: 'high', delay: 0 },
                            { from: 'scada', to: 'assets', intensity: 'high', delay: 200 },
                            { from: 'assets', to: 'projects', intensity: 'medium', delay: 400 },
                            { from: 'schedule', to: 'projects', intensity: 'medium', delay: 600 },
                            { from: 'assets', to: 'compliance', intensity: 'low', delay: 800 }
                        ],
                        highlightNodes: ['gis', 'scada', 'assets', 'projects', 'schedule', 'compliance']
                    },
                    {
                        name: 'Hydraulic Modeling',
                        text: 'Hydraulic Modeling', 
                        description: 'Real-time simulation and predictive analytics',
                        primaryColor: 'rgba(105, 240, 174, 0.8)',
                        secondaryColor: 'rgba(0, 200, 83, 0.6)',
                        flows: [
                            { from: 'scada', to: 'modeling', intensity: 'high', delay: 0 },
                            { from: 'ami', to: 'modeling', intensity: 'high', delay: 150 },
                            { from: 'gis', to: 'modeling', intensity: 'medium', delay: 300 },
                            { from: 'modeling', to: 'projects', intensity: 'medium', delay: 500 },
                            { from: 'modeling', to: 'alerts', intensity: 'medium', delay: 650 },
                            { from: 'modeling', to: 'compliance', intensity: 'low', delay: 800 }
                        ],
                        highlightNodes: ['scada', 'ami', 'gis', 'modeling', 'projects', 'alerts']
                    },
                    {
                        name: 'Knowledge Management',
                        text: 'Knowledge Management',
                        description: 'AI-powered insights and decision support', 
                        primaryColor: 'rgba(255, 193, 7, 0.8)',
                        secondaryColor: 'rgba(255, 152, 0, 0.6)',
                        flows: [
                            { from: 'docs', to: 'knowledge', intensity: 'high', delay: 0 },
                            { from: 'cusi', to: 'knowledge', intensity: 'medium', delay: 200 },
                            { from: 'assets', to: 'knowledge', intensity: 'medium', delay: 350 },
                            { from: 'modeling', to: 'knowledge', intensity: 'medium', delay: 500 },
                            { from: 'knowledge', to: 'alerts', intensity: 'high', delay: 700 },
                            { from: 'knowledge', to: 'compliance', intensity: 'medium', delay: 900 }
                        ],
                        highlightNodes: ['docs', 'cusi', 'assets', 'modeling', 'knowledge', 'alerts', 'compliance']
                    }
                ];
                
                this.init();
            }
            
            init() {
                document.addEventListener('DOMContentLoaded', () => {
                    this.setupCanvas();
                    this.initializeNodes();
                    this.setupThemeRotation();
                    this.startAnimation();
                });
            }
            
            setupCanvas() {
                this.canvas = document.getElementById('particleCanvas');
                this.container = document.querySelector('.knowledge-graph');
                if (!this.canvas || !this.container) {
                    console.log('Knowledge graph elements not found - skipping initialization');
                    return;
                }
                
                this.ctx = this.canvas.getContext('2d');
                if (!this.ctx) {
                    console.log('Could not get canvas context - skipping initialization');
                    return;
                }
                
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
            }
            
            resizeCanvas() {
                if (!this.container || !this.canvas) return; // Safety check
                
                const rect = this.container.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
            }
            
            initializeNodes() {
                setTimeout(() => {
                    const dataNodes = [
                        'gis', 'docs', 'scada', 'cusi', 'ami', 'schedule',
                        'knowledge', 'assets', 'projects', 'alerts', 'modeling', 'compliance'
                    ];
                    const angles = [0, 60, 120, 180, 240, 300, 30, 90, 150, 210, 270, 330];
                    dataNodes.forEach((nodeId, index) => {
                        const angle = angles[index];
                        const element = document.querySelector(`[data-type="${nodeId}"]`);
                        if (element) {
                            element.style.setProperty('--angle', angle);
                            element.style.animationDelay = `${angle * 0.01}s`;
                            this.nodes.set(nodeId, { element, angle, type: 'data' });
                        }
                    });
                    const coreElement = document.querySelector('.intelligence-core');
                    if (coreElement) {
                        this.nodes.set('core', { element: coreElement, angle: 0, type: 'core' });
                    }
                    // Start with first theme
                    this.activateTheme(0);
                }, 100);
            }
            
            setupThemeRotation() {
                // Slower rotation for better appreciation
                setInterval(() => {
                    if (!this.isTransitioning) {
                        this.nextTheme();
                    }
                }, 6000); // 6 seconds per theme
            }
            
            nextTheme() {
                this.currentTheme = (this.currentTheme + 1) % this.themes.length;
                this.activateTheme(this.currentTheme);
            }
            
            activateTheme(themeIndex) {
                if (this.isTransitioning) return;
                if (!this.container) return; // Safety check
                
                this.isTransitioning = true;
                this.currentTheme = themeIndex;
                const theme = this.themes[themeIndex];
                
                // Set theme data attribute for CSS theming
                this.container.setAttribute('data-theme', themeIndex);
                
                // Dramatic transition sequence
                this.startThemeTransition(theme);
            }
            
            startThemeTransition(theme) {
                // Smooth, non-jarring transition
                this.clearParticles();
                this.updateThemeText(theme);
                this.updateNodeEmphasis(theme);
                this.activateParticleFlows(theme);
            }
            
            clearParticles() {
                // Gradually fade out existing particles
                this.particles.forEach(particle => {
                    particle.life *= 0.3;
                });
            }
            
            updateThemeText(theme) {
                const textElement = document.querySelector('.rotating-text');
                if (textElement) {
                    textElement.style.transition = 'all 0.4s ease';
                    textElement.style.opacity = '0.7';
                    
                    setTimeout(() => {
                        textElement.textContent = theme.text;
                        textElement.style.opacity = '1';
                        textElement.style.color = theme.primaryColor;
                        textElement.style.textShadow = `0 0 20px ${theme.primaryColor}`;
                    }, 200);
                }
            }
            
            updateNodeEmphasis(theme) {
                // Reset all nodes to baseline state
                this.nodes.forEach(node => {
                    if (node.element) {
                        node.element.classList.remove('kg-primary', 'kg-secondary', 'kg-inactive');
                        node.element.style.filter = '';
                    }
                });
                
                // Apply subtle emphasis without changing layout
                const primaryNodes = theme.highlightNodes.slice(0, 3);
                const secondaryNodes = theme.highlightNodes.slice(3);
                
                // Highlight primary nodes (key to this theme)
                primaryNodes.forEach(nodeId => {
                    const node = this.nodes.get(nodeId);
                    if (node?.element) {
                        node.element.classList.add('kg-primary');
                        node.element.style.filter = `drop-shadow(0 0 12px ${theme.primaryColor})`;
                    }
                });
                
                // Subtle highlight for secondary nodes
                secondaryNodes.forEach(nodeId => {
                    const node = this.nodes.get(nodeId);
                    if (node?.element) {
                        node.element.classList.add('kg-secondary');
                        node.element.style.filter = `drop-shadow(0 0 8px ${theme.secondaryColor})`;
                    }
                });
                
                // Slightly de-emphasize unrelated nodes
                this.nodes.forEach((node, nodeId) => {
                    if (!theme.highlightNodes.includes(nodeId) && nodeId !== 'core') {
                        if (node.element) {
                            node.element.classList.add('kg-inactive');
                        }
                    }
                });
            }
            
            activateParticleFlows(theme) {
                // Start particle flows with staggered timing
                theme.flows.forEach(flow => {
                    setTimeout(() => {
                        this.createThemeParticleFlow(flow, theme);
                    }, flow.delay);
                });
                
                // Complete transition smoothly
                setTimeout(() => {
                    this.isTransitioning = false;
                }, 1500);
            }
            
            createThemeParticleFlow(flow, theme) {
                const fromNode = this.nodes.get(flow.from);
                const toNode = this.nodes.get(flow.to);
                
                if (!fromNode || !toNode) return;
                
                const fromPos = this.getNodePosition(fromNode);
                const toPos = this.getNodePosition(toNode);
                
                // Intensity-based particle count and characteristics  
                const particleCount = flow.intensity === 'high' ? 15 : flow.intensity === 'medium' ? 10 : 6;
                const particleSize = flow.intensity === 'high' ? 5 : flow.intensity === 'medium' ? 3.5 : 2.5;
                const color = flow.intensity === 'high' ? theme.primaryColor : theme.secondaryColor;
                
                // Create particles with staggered release
                for (let i = 0; i < particleCount; i++) {
                    setTimeout(() => {
                        this.particles.push(new ThemeParticle(fromPos, toPos, color, particleSize, theme));
                    }, i * 80);
                }
            }
            
            getNodePosition(node) {
                if (!node.element) return { x: 0, y: 0 };
                
                const rect = node.element.getBoundingClientRect();
                const canvasRect = this.canvas.getBoundingClientRect();
                
                return {
                    x: rect.left + rect.width / 2 - canvasRect.left,
                    y: rect.top + rect.height / 2 - canvasRect.top
                };
            }
            
            startAnimation() {
                if (!this.ctx || !this.canvas) return; // Safety check
                
                const animate = () => {
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    
                    this.particles = this.particles.filter(particle => {
                        particle.update();
                        particle.draw(this.ctx);
                        return particle.life > 0;
                    });
                    
                    this.animationId = requestAnimationFrame(animate);
                };
                
                animate();
            }
            
            destroy() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
            }
        }
        
        // Enhanced particle class for theme-specific effects
        class ThemeParticle {
            constructor(start, end, color, size, theme) {
                this.start = { ...start };
                this.end = { ...end };
                this.position = { ...start };
                this.color = color;
                this.theme = theme;
                this.life = 1.0;
                this.speed = 0.015 + Math.random() * 0.02;
                this.progress = 0;
                this.size = size;
                this.trail = [];
                this.maxTrailLength = 10;
                this.glowIntensity = 0.8;
            }
            
            update() {
                this.progress += this.speed;
                
                const eased = this.easeInOutCubic(this.progress);
                
                this.position.x = this.start.x + (this.end.x - this.start.x) * eased;
                this.position.y = this.start.y + (this.end.y - this.start.y) * eased;
                
                this.trail.push({ ...this.position });
                if (this.trail.length > this.maxTrailLength) {
                    this.trail.shift();
                }
                
                if (this.progress >= 1) {
                    this.life -= 0.03;
                } else {
                    this.life = Math.min(1, this.progress * 4);
                }
            }
            
            draw(ctx) {
                if (this.life <= 0) return;
                
                // Enhanced trail with theme colors
                for (let i = 0; i < this.trail.length; i++) {
                    const trailPoint = this.trail[i];
                    const trailAlpha = (i / this.trail.length) * this.life * 0.4;
                    const trailSize = (i / this.trail.length) * this.size * 0.6;
                    
                    ctx.save();
                    ctx.globalAlpha = trailAlpha;
                    ctx.fillStyle = this.theme.secondaryColor;
                    ctx.beginPath();
                    ctx.arc(trailPoint.x, trailPoint.y, trailSize, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
                
                // Main particle with enhanced glow
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 15 * this.glowIntensity;
                ctx.shadowColor = this.color;
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Inner bright core
                ctx.shadowBlur = 0;
                ctx.fillStyle = `rgba(255, 255, 255, ${this.life * 0.8})`;
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.size * 0.4, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
            
            easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }
        }
        
        // Initialize the focused knowledge graph only if required elements exist
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('particleCanvas');
            const container = document.querySelector('.knowledge-graph');
            
            // Only initialize if both canvas and container exist (not on homepage)
            if (canvas && container) {
                const focusedGraph = new FocusedKnowledgeGraph();
            }
        });
    </script>
</body>
</html> 